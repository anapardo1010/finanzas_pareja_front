<div class="couple-page">
  <div class="page-header">
    <h1 class="page-title">Gesti贸n de Pareja</h1>
    <p class="subtitle">Configura las contribuciones de cada integrante</p>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando usuarios...</p>
    </div>
  } @else {
    <div class="users-grid">
      @for (user of users(); track user.id) {
        <div class="user-card">
          <div class="user-avatar">
            {{ user.name.charAt(0).toUpperCase() }}
          </div>
          <div class="user-info">
            <h3 class="user-name">{{ user.name }}</h3>
            <p class="user-email">{{ user.email }}</p>
            <div class="contribution-badge">
              <span class="percentage">{{ user.contributionPercentage || 0 }}%</span>
              <span class="label">de contribuci贸n</span>
            </div>
          </div>
          <button class="btn-edit" (click)="openEditForm(user)">
            <lucide-icon [img]="Edit2" [size]="16" style="vertical-align: middle; margin-right: 4px;"></lucide-icon>Editar
          </button>
        </div>
      }

      @if (users().length < 2) {
        <div class="invite-card" (click)="openInviteForm()">
          <div class="invite-icon"></div>
          <h3>Invita a tu pareja</h3>
          <p>Agrega a tu pareja para compartir finanzas</p>
        </div>
      }
    </div>

    @if (users().length === 2) {
      <div class="summary-card">
        <h3>Resumen de Contribuciones</h3>
        <div class="summary-content">
          <div class="summary-item">
            <span class="label">Total configurado:</span>
            <span class="value" [class.warning]="getTotalPercentage() !== 100">
              {{ getTotalPercentage() }}%
            </span>
          </div>
          @if (getTotalPercentage() !== 100) {
            <div class="alert-warning">
              锔 El total debe sumar 100% para repartir gastos correctamente
            </div>
          }
        </div>
      </div>
    }
  }
</div>

<!-- Modal Invitar -->
@if (showInviteForm()) {
  <div class="modal-overlay" (click)="closeInviteForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Invitar a tu pareja</h2>
        <button class="btn-close" (click)="closeInviteForm()"></button>
      </div>

      <form [formGroup]="inviteForm" (ngSubmit)="onInviteSubmit()">
        <div class="form-body">
          <div class="form-group">
            <label for="name">Nombre</label>
            <input id="name" type="text" formControlName="name" placeholder="Nombre completo">
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input id="email" type="email" formControlName="email" placeholder="correo@ejemplo.com">
          </div>

          <div class="form-group">
            <label for="password">Contrase帽a</label>
            <input id="password" type="password" formControlName="password" placeholder="M铆nimo 6 caracteres">
          </div>

          <div class="info-box">
            <span class="icon">癸</span>
            <p>Tu pareja podr谩 iniciar sesi贸n con este email y contrase帽a para acceder a las finanzas compartidas.</p>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeInviteForm()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="inviteForm.invalid">
            Enviar Invitaci贸n
          </button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Modal Editar -->
@if (showEditForm()) {
  <div class="modal-overlay" (click)="closeEditForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Editar Usuario</h2>
        <button class="btn-close" (click)="closeEditForm()"></button>
      </div>

      <form [formGroup]="editForm" (ngSubmit)="onEditSubmit()">
        <div class="form-body">
          <div class="form-group">
            <label for="edit-name">Nombre</label>
            <input id="edit-name" type="text" formControlName="name" placeholder="Nombre completo">
          </div>

          <div class="form-group">
            <label for="edit-email">Email</label>
            <input id="edit-email" type="email" formControlName="email" placeholder="correo@ejemplo.com">
          </div>

          <div class="form-group">
            <label for="contribution">Porcentaje de Contribuci贸n (%)</label>
            <input 
              id="contribution" 
              type="number" 
              formControlName="contributionPercentage" 
              min="0" 
              max="100"
              placeholder="50"
            >
            <small class="form-hint">Indica qu茅 porcentaje de los gastos compartidos asumir谩 este usuario</small>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditForm()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid">
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>
}
