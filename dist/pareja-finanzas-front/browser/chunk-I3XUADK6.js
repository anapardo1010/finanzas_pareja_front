import{d as V}from"./chunk-S7R6ZZJZ.js";import{a as H}from"./chunk-S43CPWHX.js";import{k as T,s as z,t as N}from"./chunk-6SYOXZTD.js";import{b as U,c as s,d as j,e as D,h as q,i as G,k as A,l as L,p as B,q as R,t as $,v as Y}from"./chunk-LBFPTU6L.js";import{g as I}from"./chunk-JJXHLCZR.js";import{$a as n,Ja as w,Q as b,Ua as _,V as m,Va as f,W as p,Xa as E,Xb as k,Ya as S,Za as x,_a as t,a as M,ab as g,b as y,db as v,eb as u,fa as C,fb as c,mb as F,ob as i,pb as O,qb as h,wa as d}from"./chunk-UF2Z5XWL.js";var K=(a,o)=>o.id;function Q(a,o){a&1&&(t(0,"div",4),g(1,"div",6),t(2,"p"),i(3,"Cargando usuarios..."),n()())}function W(a,o){if(a&1){let e=v();t(0,"div",8)(1,"div",11),i(2),n(),t(3,"div",12)(4,"h3",13),i(5),n(),t(6,"p",14),i(7),n(),t(8,"div",15)(9,"span",16),i(10),n(),t(11,"span",17),i(12,"de contribuci\xF3n"),n()()(),t(13,"button",18),u("click",function(){let r=m(e).$implicit,P=c(2);return p(P.openEditForm(r))}),g(14,"lucide-icon",19),i(15,"Editar "),n()()}if(a&2){let e=o.$implicit,l=c(2);d(2),h(" ",e.name.charAt(0).toUpperCase()," "),d(3),O(e.name),d(2),O(e.email),d(3),h("",e.contributionPercentage||0,"%"),d(4),x("img",l.Edit2)("size",16)}}function X(a,o){if(a&1){let e=v();t(0,"div",20),u("click",function(){m(e);let r=c(2);return p(r.openInviteForm())}),t(1,"div",21),i(2,"\u{1F46B}"),n(),t(3,"h3"),i(4,"Invita a tu pareja"),n(),t(5,"p"),i(6,"Agrega a tu pareja para compartir finanzas"),n()()}}function Z(a,o){a&1&&(t(0,"div",25),i(1," \u26A0\uFE0F El total debe sumar 100% para repartir gastos correctamente "),n())}function ee(a,o){if(a&1&&(t(0,"div",10)(1,"h3"),i(2,"Resumen de Contribuciones"),n(),t(3,"div",22)(4,"div",23)(5,"span",17),i(6,"Total configurado:"),n(),t(7,"span",24),i(8),n()(),_(9,Z,2,0,"div",25),n()()),a&2){let e=c(2);d(7),F("warning",e.getTotalPercentage()!==100),d(),h(" ",e.getTotalPercentage(),"% "),d(),f(e.getTotalPercentage()!==100?9:-1)}}function te(a,o){if(a&1&&(t(0,"div",7),E(1,W,16,6,"div",8,K),_(3,X,7,0,"div",9),n(),_(4,ee,10,4,"div",10)),a&2){let e=c();d(),S(e.users()),d(2),f(e.users().length<2?3:-1),d(),f(e.users().length===2?4:-1)}}function ne(a,o){if(a&1){let e=v();t(0,"div",26),u("click",function(){m(e);let r=c();return p(r.closeInviteForm())}),t(1,"div",27),u("click",function(r){return m(e),p(r.stopPropagation())}),t(2,"div",28)(3,"h2"),i(4,"Invitar a tu pareja"),n(),t(5,"button",29),u("click",function(){m(e);let r=c();return p(r.closeInviteForm())}),i(6,"\xD7"),n()(),t(7,"form",30),u("ngSubmit",function(){m(e);let r=c();return p(r.onInviteSubmit())}),t(8,"div",31)(9,"div",32)(10,"label",33),i(11,"Nombre"),n(),g(12,"input",34),n(),t(13,"div",32)(14,"label",35),i(15,"Email"),n(),g(16,"input",36),n(),t(17,"div",32)(18,"label",37),i(19,"Contrase\xF1a"),n(),g(20,"input",38),n(),t(21,"div",39)(22,"span",40),i(23,"\u2139\uFE0F"),n(),t(24,"p"),i(25,"Tu pareja podr\xE1 iniciar sesi\xF3n con este email y contrase\xF1a para acceder a las finanzas compartidas."),n()()(),t(26,"div",41)(27,"button",42),u("click",function(){m(e);let r=c();return p(r.closeInviteForm())}),i(28," Cancelar "),n(),t(29,"button",43),i(30," Enviar Invitaci\xF3n "),n()()()()()}if(a&2){let e=c();d(7),x("formGroup",e.inviteForm),d(22),x("disabled",e.inviteForm.invalid)}}function ie(a,o){if(a&1){let e=v();t(0,"div",26),u("click",function(){m(e);let r=c();return p(r.closeEditForm())}),t(1,"div",27),u("click",function(r){return m(e),p(r.stopPropagation())}),t(2,"div",28)(3,"h2"),i(4,"Editar Usuario"),n(),t(5,"button",29),u("click",function(){m(e);let r=c();return p(r.closeEditForm())}),i(6,"\xD7"),n()(),t(7,"form",30),u("ngSubmit",function(){m(e);let r=c();return p(r.onEditSubmit())}),t(8,"div",31)(9,"div",32)(10,"label",44),i(11,"Nombre"),n(),g(12,"input",45),n(),t(13,"div",32)(14,"label",46),i(15,"Email"),n(),g(16,"input",47),n(),t(17,"div",32)(18,"label",48),i(19,"Porcentaje de Contribuci\xF3n (%)"),n(),g(20,"input",49),t(21,"small",50),i(22,"Indica qu\xE9 porcentaje de los gastos compartidos asumir\xE1 este usuario"),n()()(),t(23,"div",41)(24,"button",42),u("click",function(){m(e);let r=c();return p(r.closeEditForm())}),i(25," Cancelar "),n(),t(26,"button",43),i(27," Guardar Cambios "),n()()()()()}if(a&2){let e=c();d(7),x("formGroup",e.editForm),d(19),x("disabled",e.editForm.invalid)}}var J=class a{Edit2=T;fb=b($);authService=b(I);userService=b(H);router=b(V);users=C([]);loading=C(!1);showInviteForm=C(!1);showEditForm=C(!1);selectedUser=C(null);inviteForm;editForm;ngOnInit(){this.initForms(),this.loadUsers()}initForms(){this.inviteForm=this.fb.group({name:["",[s.required,s.minLength(3)]],email:["",[s.required,s.email]],password:["",[s.required,s.minLength(6)]]}),this.editForm=this.fb.group({name:["",[s.required,s.minLength(3)]],email:["",[s.required,s.email]],contributionPercentage:[50,[s.required,s.min(0),s.max(100)]]})}loadUsers(){let o=this.authService.getTenantId();o&&(this.loading.set(!0),this.userService.getUsersByTenant(o).subscribe({next:e=>{this.users.set(e),this.loading.set(!1)},error:e=>{console.error("Error loading users:",e),this.loading.set(!1)}}))}openInviteForm(){this.inviteForm.reset({name:"",email:"",password:""}),this.showInviteForm.set(!0)}openEditForm(o){this.selectedUser.set(o),this.editForm.patchValue({name:o.name,email:o.email,contributionPercentage:o.contributionPercentage||50}),this.showEditForm.set(!0)}onInviteSubmit(){if(this.inviteForm.invalid)return;let o=this.authService.getTenantId();if(!o)return;let e=this.inviteForm.value,l=y(M({},e),{tenantId:o});this.authService.registerInvite(l).subscribe({next:()=>{this.loadUsers(),this.closeInviteForm(),alert("\xA1Invitaci\xF3n enviada! Tu pareja puede iniciar sesi\xF3n con ese email y contrase\xF1a.")},error:r=>{console.error("Error inviting user:",r),alert("Error al enviar la invitaci\xF3n. Verifica que el email no est\xE9 en uso.")}})}onEditSubmit(){if(this.editForm.invalid)return;let o=this.selectedUser();if(!o)return;let e=this.authService.getTenantId();if(!e)return;let l=this.editForm.value,r=M({tenantId:e},l);this.userService.updateUser(o.id,r).subscribe({next:()=>{this.loadUsers(),this.closeEditForm()},error:P=>{console.error("Error updating user:",P)}})}closeInviteForm(){this.showInviteForm.set(!1)}closeEditForm(){this.showEditForm.set(!1),this.selectedUser.set(null)}getTotalPercentage(){return this.users().reduce((o,e)=>o+(e.contributionPercentage||0),0)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-couple"]],decls:10,vars:3,consts:[[1,"couple-page"],[1,"page-header"],[1,"page-title"],[1,"subtitle"],[1,"loading-state"],[1,"modal-overlay"],[1,"spinner"],[1,"users-grid"],[1,"user-card"],[1,"invite-card"],[1,"summary-card"],[1,"user-avatar"],[1,"user-info"],[1,"user-name"],[1,"user-email"],[1,"contribution-badge"],[1,"percentage"],[1,"label"],[1,"btn-edit",3,"click"],[2,"vertical-align","middle","margin-right","4px",3,"img","size"],[1,"invite-card",3,"click"],[1,"invite-icon"],[1,"summary-content"],[1,"summary-item"],[1,"value"],[1,"alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"btn-close",3,"click"],[3,"ngSubmit","formGroup"],[1,"form-body"],[1,"form-group"],["for","name"],["id","name","type","text","formControlName","name","placeholder","Nombre completo"],["for","email"],["id","email","type","email","formControlName","email","placeholder","correo@ejemplo.com"],["for","password"],["id","password","type","password","formControlName","password","placeholder","M\xEDnimo 6 caracteres"],[1,"info-box"],[1,"icon"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["for","edit-name"],["id","edit-name","type","text","formControlName","name","placeholder","Nombre completo"],["for","edit-email"],["id","edit-email","type","email","formControlName","email","placeholder","correo@ejemplo.com"],["for","contribution"],["id","contribution","type","number","formControlName","contributionPercentage","min","0","max","100","placeholder","50"],[1,"form-hint"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),i(3,"Gesti\xF3n de Pareja"),n(),t(4,"p",3),i(5,"Configura las contribuciones de cada integrante"),n()(),_(6,Q,4,0,"div",4)(7,te,5,2),n(),_(8,ne,31,2,"div",5),_(9,ie,28,2,"div",5)),e&2&&(d(6),f(l.loading()?6:7),d(2),f(l.showInviteForm()?8:-1),d(),f(l.showEditForm()?9:-1))},dependencies:[k,Y,q,U,G,j,D,R,B,L,A,N,z],styles:[".couple-page[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:40px}.page-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-size:32px;font-weight:600;color:#1d1d1f;margin:0 0 8px}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:16px;color:#6e6e73;margin:0}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;margin:0 auto 20px;border:4px solid rgba(0,0,0,.08);border-top-color:#af52de;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6e6e73}.users-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px}.user-card[_ngcontent-%COMP%], .invite-card[_ngcontent-%COMP%]{background:#f5f5f7;border-radius:20px;padding:30px;border:1px solid rgba(0,0,0,.08);display:flex;flex-direction:column;align-items:center;gap:20px;transition:all .3s ease}.user-card[_ngcontent-%COMP%]:hover, .invite-card[_ngcontent-%COMP%]:hover{border-color:#af52de;transform:translateY(-4px);box-shadow:0 8px 20px #8b5cf626}.user-card[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#af52de,#5ac8fa);display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:600;color:#fff}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{text-align:center;flex:1}.user-card[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1d1d1f;margin:0 0 8px}.user-card[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{font-size:14px;color:#6e6e73;margin:0 0 16px}.user-card[_ngcontent-%COMP%]   .contribution-badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:4px;background:#34c7591a;padding:12px 24px;border-radius:12px}.user-card[_ngcontent-%COMP%]   .contribution-badge[_ngcontent-%COMP%]   .percentage[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#34c759}.user-card[_ngcontent-%COMP%]   .contribution-badge[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#6e6e73}.user-card[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]{width:100%;padding:12px 24px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:transparent;color:#1d1d1f;font-size:14px;font-weight:600;cursor:pointer;transition:all .3s ease}.user-card[_ngcontent-%COMP%]   .btn-edit[_ngcontent-%COMP%]:hover{background:#eaeaea;border-color:#af52de;color:#af52de}.invite-card[_ngcontent-%COMP%]{cursor:pointer;justify-content:center;min-height:300px;border:2px dashed rgba(0,0,0,.08);background:#af52de05}.invite-card[_ngcontent-%COMP%]:hover{border-color:#af52de;background:#af52de0d}.invite-card[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]{font-size:64px}.invite-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1d1d1f;margin:0}.invite-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#6e6e73;margin:0}.summary-card[_ngcontent-%COMP%]{background:#f5f5f7;border-radius:20px;padding:24px;border:1px solid rgba(0,0,0,.08)}.summary-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1d1d1f;margin:0 0 16px}.summary-card[_ngcontent-%COMP%]   .summary-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.summary-card[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.summary-card[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:14px;color:#6e6e73}.summary-card[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#34c759}.summary-card[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .value.warning[_ngcontent-%COMP%]{color:#ff9500}.summary-card[_ngcontent-%COMP%]   .alert-warning[_ngcontent-%COMP%]{background:#ff95001a;border:1px solid rgba(255,149,0,.3);border-radius:12px;padding:12px 16px;font-size:14px;color:#ff9500}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:20px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:24px;border-bottom:1px solid rgba(0,0,0,.08)}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1d1d1f;margin:0}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px;border:none;background:transparent;font-size:24px;cursor:pointer;color:#6e6e73}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{background:#eaeaea}.form-body[_ngcontent-%COMP%]{padding:24px;display:flex;flex-direction:column;gap:20px}.form-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#1d1d1f}.form-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:12px 16px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:#f5f5f7;color:#1d1d1f;font-size:14px}.form-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#af52de}.form-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-hint[_ngcontent-%COMP%]{font-size:12px;color:#6e6e73}.form-body[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]{display:flex;gap:12px;background:#5ac8fa1a;border:1px solid rgba(90,200,250,.3);border-radius:12px;padding:16px}.form-body[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:20px}.form-body[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#1d1d1f;margin:0;line-height:1.5}.modal-footer[_ngcontent-%COMP%]{display:flex;gap:12px;padding:24px;border-top:1px solid rgba(0,0,0,.08)}.modal-footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1;padding:12px 24px;border-radius:12px;border:none;font-size:14px;font-weight:600;cursor:pointer}.modal-footer[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{background:#eaeaea;color:#1d1d1f}.modal-footer[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#af52de,#7c3aed);color:#fff}.modal-footer[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media(max-width:768px){.users-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{J as CoupleComponent};
