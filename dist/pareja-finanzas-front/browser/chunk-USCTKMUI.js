import{a as Q}from"./chunk-DVSV6Z42.js";import{B as j,C as A,D as G,o as U,r as z,y as D}from"./chunk-QWECJNWK.js";import{b as q,c as m,d as L,e as $,h as B,i as R,j as X,k as H,s as J,u as K}from"./chunk-EFCWVEXT.js";import{h as N}from"./chunk-3SXPRKRB.js";import{$a as t,Ka as k,Q as F,V as p,Va as C,W as u,Wa as f,Xa as I,Ya as T,Za as x,_a as n,_b as V,a as E,ab as _,b as y,fa as v,fb as P,gb as g,hb as d,ob as M,qb as i,rb as w,sb as S,xa as a}from"./chunk-VKFMD7IK.js";var Y=(r,o)=>o.id;function Z(r,o){r&1&&(n(0,"div",2),i(1,"Cargando..."),t())}function ee(r,o){if(r&1){let e=P();n(0,"div",5)(1,"div",8)(2,"div",9),i(3),t(),n(4,"div",10)(5,"h3"),i(6),t(),n(7,"p"),i(8),t()()(),n(9,"div",11)(10,"span",12),i(11,"Aportaci\xF3n"),t(),n(12,"span",13),i(13),t()(),n(14,"button",14),g("click",function(){let l=p(e).$implicit,b=d(2);return u(b.openEditForm(l))}),_(15,"lucide-icon",15),i(16," Editar Perfil "),t()()}if(r&2){let e=o.$implicit,c=d(2);a(3),w(e.name.charAt(0)),a(3),w(e.name),a(2),w(e.email),a(5),S("",e.contributionPercentage||0,"%"),a(2),x("img",c.icons.Edit2)("size",16)}}function te(r,o){if(r&1){let e=P();n(0,"div",16),g("click",function(){p(e);let l=d(2);return u(l.openInviteForm())}),_(1,"lucide-icon",15),n(2,"span"),i(3,"A\xF1adir Pareja"),t()()}if(r&2){let e=d(2);a(),x("img",e.icons.UserPlus)("size",32)}}function ne(r,o){if(r&1&&(n(0,"div",17),_(1,"lucide-icon",15),n(2,"span"),i(3,"Suma total: "),n(4,"strong"),i(5),t()()()),r&2){let e=d(2);M("is-error",e.getTotalPercentage()!==100),a(),x("img",e.icons.Info)("size",20),a(4),S("",e.getTotalPercentage(),"%")}}function oe(r,o){if(r&1&&(n(0,"div",4),I(1,ee,17,6,"div",5,Y),C(3,te,4,2,"div",6),t(),C(4,ne,6,5,"div",7)),r&2){let e=d();a(),T(e.users()),a(2),f(e.users().length<2?3:-1),a(),f(e.users().length===2?4:-1)}}function ie(r,o){r&1&&(n(0,"small",26),i(1,"Nombre requerido (m\xEDn. 2 caracteres)"),t())}function re(r,o){r&1&&(n(0,"small",26),i(1,"Email v\xE1lido requerido"),t())}function ae(r,o){r&1&&(n(0,"small",26),i(1,"Contrase\xF1a requerida (m\xEDn. 6 caracteres)"),t())}function le(r,o){if(r&1){let e=P();n(0,"div",3)(1,"div",18),g("click",function(){p(e);let l=d();return u(l.closeInviteForm())}),t(),n(2,"div",19)(3,"div",20)(4,"h2"),i(5,"A\xF1adir Pareja"),t(),n(6,"button",21),g("click",function(){p(e);let l=d();return u(l.closeInviteForm())}),i(7,"\xD7"),t()(),n(8,"form",22),g("ngSubmit",function(){p(e);let l=d();return u(l.onInviteSubmit())}),n(9,"div",23)(10,"div",24)(11,"label"),i(12,"Nombre"),t(),_(13,"input",25),C(14,ie,2,0,"small",26),t(),n(15,"div",24)(16,"label"),i(17,"Email"),t(),_(18,"input",27),C(19,re,2,0,"small",26),t(),n(20,"div",24)(21,"label"),i(22,"Contrase\xF1a Temporal"),t(),_(23,"input",28),C(24,ae,2,0,"small",26),t()(),n(25,"div",29)(26,"button",30),g("click",function(){p(e);let l=d();return u(l.closeInviteForm())}),i(27,"Cancelar"),t(),n(28,"button",31),i(29,"Invitar"),t()()()()()}if(r&2){let e,c,l,b,h,O,s=d();a(8),x("formGroup",s.inviteForm),a(5),M("error",((e=s.inviteForm.get("name"))==null?null:e.invalid)&&((e=s.inviteForm.get("name"))==null?null:e.touched)),a(),f((c=s.inviteForm.get("name"))!=null&&c.invalid&&((c=s.inviteForm.get("name"))!=null&&c.touched)?14:-1),a(4),M("error",((l=s.inviteForm.get("email"))==null?null:l.invalid)&&((l=s.inviteForm.get("email"))==null?null:l.touched)),a(),f((b=s.inviteForm.get("email"))!=null&&b.invalid&&((b=s.inviteForm.get("email"))!=null&&b.touched)?19:-1),a(4),M("error",((h=s.inviteForm.get("password"))==null?null:h.invalid)&&((h=s.inviteForm.get("password"))==null?null:h.touched)),a(),f((O=s.inviteForm.get("password"))!=null&&O.invalid&&((O=s.inviteForm.get("password"))!=null&&O.touched)?24:-1),a(4),x("disabled",s.inviteForm.invalid)}}function ce(r,o){if(r&1){let e=P();n(0,"div",3)(1,"div",18),g("click",function(){p(e);let l=d();return u(l.closeEditForm())}),t(),n(2,"div",19)(3,"div",20)(4,"h2"),i(5,"Editar Integrante"),t(),n(6,"button",21),g("click",function(){p(e);let l=d();return u(l.closeEditForm())}),i(7,"\xD7"),t()(),n(8,"form",22),g("ngSubmit",function(){p(e);let l=d();return u(l.onEditSubmit())}),n(9,"div",23)(10,"div",24)(11,"label"),i(12,"Nombre"),t(),_(13,"input",32),t(),n(14,"div",24)(15,"label"),i(16,"Email"),t(),_(17,"input",33),t(),n(18,"div",24)(19,"label"),i(20,"Porcentaje de Aportaci\xF3n (%)"),t(),_(21,"input",34),t()(),n(22,"div",29)(23,"button",30),g("click",function(){p(e);let l=d();return u(l.closeEditForm())}),i(24,"Cancelar"),t(),n(25,"button",31),i(26,"Guardar"),t()()()()()}if(r&2){let e=d();a(8),x("formGroup",e.editForm),a(17),x("disabled",e.editForm.invalid)}}var W=class r{icons={Edit2:z,UserPlus:D,Info:U,X:j};fb=F(J);authService=F(N);userService=F(Q);users=v([]);loading=v(!1);showInviteForm=v(!1);showEditForm=v(!1);selectedUser=v(null);inviteForm;editForm;ngOnInit(){this.initForms(),this.loadUsers()}initForms(){this.inviteForm=this.fb.group({name:["",[m.required,m.minLength(2)]],email:["",[m.required,m.email]],password:["",[m.required,m.minLength(6)]]}),this.editForm=this.fb.group({name:["",[m.required]],email:["",[m.email]],contributionPercentage:[0,[m.required,m.min(0),m.max(100)]]})}loadUsers(){let o=this.authService.getTenantId();o&&(this.loading.set(!0),this.userService.getUsersByTenant(o).subscribe({next:e=>{this.users.set(e),this.loading.set(!1)},error:()=>this.loading.set(!1)}))}openEditForm(o){this.selectedUser.set(o),this.editForm.patchValue({name:o.name,email:o.email,contributionPercentage:o.contributionPercentage??0}),this.showEditForm.set(!0)}onEditSubmit(){if(this.editForm.invalid)return;let o=this.selectedUser(),e=this.authService.getTenantId();o&&e&&this.userService.updateUser(o.id,y(E({},this.editForm.value),{tenantId:e})).subscribe({next:()=>{this.loadUsers(),this.closeEditForm()}})}onInviteSubmit(){if(this.inviteForm.invalid)return;let o=this.authService.getTenantId();if(!o){console.error("No se encontr\xF3 el Tenant ID");return}this.loading.set(!0);let e=y(E({},this.inviteForm.value),{tenantId:Number(o)});this.authService.registerInvite(e).subscribe({next:()=>{this.loadUsers(),this.closeInviteForm(),this.loading.set(!1)},error:c=>{console.error("Error al invitar:",c),this.loading.set(!1)}})}openInviteForm(){this.inviteForm.reset(),this.showInviteForm.set(!0)}closeInviteForm(){this.showInviteForm.set(!1)}closeEditForm(){this.showEditForm.set(!1),this.selectedUser.set(null)}getTotalPercentage=()=>this.users().reduce((o,e)=>o+(e.contributionPercentage||0),0);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-couple"]],decls:10,vars:3,consts:[[1,"couple-page"],[1,"header"],[1,"loader"],[1,"modal-container"],[1,"users-grid"],[1,"user-card"],[1,"add-partner"],[1,"total-status",3,"is-error"],[1,"user-info"],[1,"avatar"],[1,"text"],[1,"contribution-box"],[1,"label"],[1,"value"],[1,"btn-edit-user",3,"click"],[3,"img","size"],[1,"add-partner",3,"click"],[1,"total-status"],[1,"modal-overlay",3,"click"],[1,"modal-body"],[1,"modal-header"],[1,"close-btn",3,"click"],[3,"ngSubmit","formGroup"],[1,"modal-content"],[1,"field"],["type","text","formControlName","name","placeholder","Ej. Ana Garc\xEDa"],[1,"error-msg"],["type","email","formControlName","email","placeholder","correo@pareja.com"],["type","password","formControlName","password"],[1,"modal-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-save",3,"disabled"],["type","text","formControlName","name"],["type","email","formControlName","email","readonly",""],["type","number","formControlName","contributionPercentage"]],template:function(e,c){e&1&&(n(0,"div",0)(1,"header",1)(2,"h1"),i(3,"Gesti\xF3n de Pareja"),t(),n(4,"p"),i(5,"Configura las aportaciones de cada integrante"),t()(),C(6,Z,2,0,"div",2)(7,oe,5,2),t(),C(8,le,30,11,"div",3),C(9,ce,27,2,"div",3)),e&2&&(a(6),f(c.loading()?6:7),a(2),f(c.showInviteForm()?8:-1),a(),f(c.showEditForm()?9:-1))},dependencies:[V,K,B,q,R,L,$,H,X,G,A],styles:[".couple-page[_ngcontent-%COMP%]{padding:40px 20px;max-width:1100px;margin:0 auto}.couple-page[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:40px}.couple-page[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#0f172a;font-size:32px;font-weight:800;margin:0}.couple-page[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;font-size:16px}.users-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin-bottom:40px}.user-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:20px;padding:24px;box-shadow:0 4px 6px -1px #0000001a}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:24px}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:50px;height:50px;background:#4f46e5;color:#fff;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#0f172a;margin:0;font-size:18px}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;margin:0;font-size:14px}.user-card[_ngcontent-%COMP%]   .contribution-box[_ngcontent-%COMP%]{background:#f8fafc;padding:16px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.user-card[_ngcontent-%COMP%]   .contribution-box[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#475569;font-weight:600;font-size:13px}.user-card[_ngcontent-%COMP%]   .contribution-box[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#4f46e5;font-weight:800;font-size:24px}.user-card[_ngcontent-%COMP%]   .btn-edit-user[_ngcontent-%COMP%]{width:100%;padding:12px;border-radius:10px;border:1px solid #e2e8f0;background:#fff;color:#0f172a;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}.user-card[_ngcontent-%COMP%]   .btn-edit-user[_ngcontent-%COMP%]:hover{border-color:#4f46e5;color:#4f46e5;background:#f5f3ff}.add-partner[_ngcontent-%COMP%]{border:2px dashed #e2e8f0;border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;min-height:200px;color:#475569;transition:all .3s ease}.add-partner[_ngcontent-%COMP%]:hover{border-color:#4f46e5;background:#f8fafc;color:#4f46e5}.add-partner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600}.modal-container[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center}.modal-container[_ngcontent-%COMP%]   .modal-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0009;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{position:relative;background:#fff;width:100%;max-width:450px;border-radius:24px;overflow:hidden;box-shadow:0 25px 50px -12px #00000040}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#0f172a;font-size:20px;font-weight:700;margin:0}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#475569}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{padding:24px}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{margin-bottom:20px}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:700;color:#0f172a;margin-bottom:8px;font-size:14px}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:10px;background:#fff;color:#0f172a;font-size:16px;font-weight:500}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#dc2626}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   .error-msg[_ngcontent-%COMP%]{color:#dc2626;font-size:12px;margin-top:4px}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{padding:20px 24px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:12px}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]{background:none;border:none;font-weight:600;color:#475569;cursor:pointer}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]{background:#4f46e5;color:#fff;border:none;padding:10px 24px;border-radius:10px;font-weight:700;cursor:pointer}.modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]   .btn-save[_ngcontent-%COMP%]:disabled{background:#cbd5e1;cursor:not-allowed}.total-status[_ngcontent-%COMP%]{padding:16px;border-radius:12px;background:#f0fdf4;border:1px solid #bbf7d0;color:#166534;display:flex;align-items:center;gap:10px}.total-status.is-error[_ngcontent-%COMP%]{background:#fef2f2;border-color:#fecaca;color:#991b1b}"]})};export{W as CoupleComponent};
