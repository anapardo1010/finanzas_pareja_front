<div class="dashboard-container">

  <header class="dashboard-header">
    <div class="welcome">
      <h1>Hola, {{ userName() }} ðŸ‘‹</h1>
      <p class="subtitle">Este es el estado de tus finanzas hoy.</p>
    </div>
    <button class="btn-primary" (click)="navigateTo('/main/transactions')">
      <lucide-icon [img]="icons.Plus" [size]="18"></lucide-icon>
      Nueva TransacciÃ³n
    </button>
  </header>

  <div class="bento-grid">

    <!-- BALANCE PRINCIPAL -->
    <div class="bento-item main-balance">
      <span class="card-label">Balance Total</span>
      <div class="main-value">{{ comparison().current | currency:'MXN':'symbol':'1.0-0' }}</div>
      <div class="comparison" [class.up]="comparison().isPositive" [class.down]="!comparison().isPositive">
        <lucide-icon [img]="comparison().isPositive ? icons.TrendingUp : icons.TrendingDown" [size]="14"></lucide-icon>
        <span>{{ comparison().percent | number:'1.1-1' }}% vs mes anterior</span>
      </div>
      <div class="balance-chart-mini">
        <canvas id="balanceChart"></canvas>
      </div>
    </div>

    <!-- INGRESOS -->
    <div class="bento-item stat-card income">
      <div class="icon-box"><lucide-icon [img]="icons.TrendingUp" [size]="22"></lucide-icon></div>
      <div class="details">
        <span class="card-label">Ingresos</span>
        <span class="value">{{ summary().income | currency:'MXN':'symbol':'1.0-0' }}</span>
      </div>
    </div>

    <!-- GASTOS -->
    <div class="bento-item stat-card expense">
      <div class="icon-box"><lucide-icon [img]="icons.TrendingDown" [size]="22"></lucide-icon></div>
      <div class="details">
        <span class="card-label">Gastos</span>
        <span class="value">{{ summary().expense | currency:'MXN':'symbol':'1.0-0' }}</span>
      </div>
    </div>

    <!-- MSI -->
    <div class="bento-item stat-card msi">
      <div class="icon-box"><lucide-icon [img]="icons.Calendar" [size]="22"></lucide-icon></div>
      <div class="details">
        <span class="card-label">Cuotas MSI</span>
        <span class="value">{{ upcomingInstallments().length }} <small>pendientes</small></span>
      </div>
    </div>

    <!-- CATEGORÃAS -->
    <div class="bento-item categories-chart">
      <div class="card-header">
        <h3>Top 10 Gastos por CategorÃ­a</h3>
        <span class="month-badge">Este mes</span>
      </div>

      <div class="categories-grid">
        @for (cat of topCategories(); track cat.name; let i = $index) {
          <div class="category-row">
            <div class="cat-left">
              <span class="cat-dot" [ngClass]="'dot-' + (i % 6)"></span>
              <span class="cat-name">{{ cat.name }}</span>
            </div>
            <div class="cat-bar-wrap">
              <div class="cat-bar-bg">
                <div class="cat-bar-fill" [ngClass]="'bar-' + (i % 6)" [style.width.%]="cat.percentage"></div>
              </div>
            </div>
            <div class="cat-right">
              <span class="cat-amount">{{ cat.amount | currency:'MXN':'symbol':'1.0-0' }}</span>
              <span class="cat-pct">{{ cat.percentage | number:'1.0-0' }}%</span>
            </div>
          </div>
        } @empty {
          <p class="empty-txt">No hay gastos este mes.</p>
        }
      </div>
    </div>

  </div>
</div>